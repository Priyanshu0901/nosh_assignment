
# Assignment 2
This program simulates a sensor data acquisition and processing system. It generates random sensor data at regular intervals and processes it periodically.

## Assumption :
1.  This code is designed to run on a Unix-like operating system (e.g., Linux, macOS). It will not compile on Windows.
2.  The code has been verified to work on this online compiler: [https://www.onlinegdb.com/](https://www.onlinegdb.com/).
3.  Docker is used for containerization and deployment.

## Running on Docker
```shell
docker build -t assignment_2 .
docker run --rm assignment_2
```

# How does this code work?

## Data generation   
- The generate_sensor_data function is responsible for simulating sensor data. It's triggered by a real-time signal (SIGALRM) generated by a timer.   
- Inside generate_sensor_data, a mutex lock (lock) is acquired to protect the shared buffer (buffer) from concurrent access.   
- A random number of bytes (between 0 and 5 inclusive due to rand() % 6) are generated and stored in the buffer. The code checks if adding the generated bytes would exceed the buffer's capacity (MAX_BUFFER_SIZE). If so, it only generates enough bytes to fill the remaining space.    
- Each generated byte is a random value between 0 and 255 (inclusive).
- Debug information (the generated bytes and the current buffer size) is printed to the console if the DEBUG macro is defined.
- The fflush(stdout) call ensures that the output is immediately flushed to the console, which is crucial in a Docker environment.
- Finally, the mutex lock is released.

## Data retrieval   
- The process_data function runs in a separate thread.
- It enters an infinite loop, sleeping for 10 seconds in each iteration.
- It acquires the mutex lock to access the shared buffer safely.
- It checks if the buffer size is greater than or equal to PRINT_THRESHOLD (50 bytes).
- If the condition is met, it processes the latest PRINT_THRESHOLD bytes from the buffer. It prints these bytes to the console if the DEBUG macro is defined.
- The processed data (the latest 50 bytes) is effectively removed from the buffer by decrementing buffer_size by PRINT_THRESHOLD. This simulates consuming or processing the data.
- The mutex lock is released.

## Main Function
- The main function initializes the random number generator, the mutex, and creates a new thread for process_data.
- It sets up a real-time timer using setitimer to generate SIGALRM signals every TIMER_INTERVAL seconds (1 second). This signal triggers the generate_sensor_data function.
- The main thread then enters an infinite loop, sleeping for 1 second in each iteration. This keeps the program running and allows the signal handler and the processing thread to do their work.
- Finally, (although this part of the code is never reached due to the infinite loop) the mutex is destroyed.

## Key definitions
- **MAX_BUFFER_SIZE**: The maximum size of the data buffer (1024 bytes).
- **PRINT_THRESHOLD**: The minimum number of bytes in the buffer before processing (50 bytes).
- **TIMER_INTERVAL**: The time interval between data generation events (1 second).
- **DOCKER_ENV**: A macro used to conditionally include fflush(stdout) which is needed for proper output in Docker.
- **DEBUG**: A macro to enable debug print statements.

This program demonstrates a basic producer-consumer pattern with a shared buffer, protected by a mutex. The data generation acts as the producer, and the data processing acts as the consumer.  The timer and signals provide a mechanism for periodic data generation.

# Output
```shell
Generated 1 bytes: D2  Current buffer size: 1
Generated 0 bytes:  Current buffer size: 1
Generated 5 bytes: 60 A2 B0 6E FE  Current buffer size: 6
Generated 1 bytes: 1C  Current buffer size: 7
Generated 2 bytes: BC 2C  Current buffer size: 9
Generated 2 bytes: A1 A6  Current buffer size: 11
Generated 3 bytes: 1A 05 87  Current buffer size: 14
Generated 3 bytes: 79 F3 1B  Current buffer size: 17
Generated 4 bytes: BB 43 44 6F  Current buffer size: 21
Generated 0 bytes:  Current buffer size: 21
Generated 5 bytes: 41 31 2A A1 D3  Current buffer size: 26
Generated 3 bytes: 0F D1 BE  Current buffer size: 29
Generated 3 bytes: AD 7A 58  Current buffer size: 32
Generated 2 bytes: 1B FE  Current buffer size: 34
Generated 5 bytes: 36 03 66 C3 7D  Current buffer size: 39
Generated 5 bytes: DE 87 15 21 CB  Current buffer size: 44
Generated 4 bytes: 81 DD C5 B2  Current buffer size: 48
Generated 1 bytes: 66  Current buffer size: 49
Generated 5 bytes: E2 75 57 A1 A1  Current buffer size: 54
Generated 2 bytes: 1B F9  Current buffer size: 56
Processing latest 50 bytes: 1C BC 2C A1 A6 1A 05 87 79 F3 1B BB 43 44 6F 41 31 2A A1 D3 0F D1 BE AD 7A 58 1B FE 36 03 66 C3 7D DE 87 15 21 CB 81 DD C5 B2 66 E2 75 57 A1 A1 1B F9 
Generated 4 bytes: 37 F7 84 6D  Current buffer size: 10
Generated 0 bytes:  Current buffer size: 10
Generated 2 bytes: 30 77  Current buffer size: 12
Generated 0 bytes:  Current buffer size: 12
Generated 0 bytes:  Current buffer size: 12
Generated 4 bytes: 59 2F CA DD  Current buffer size: 16
Generated 2 bytes: A7 A2  Current buffer size: 18
Generated 1 bytes: AE  Current buffer size: 19
Generated 4 bytes: E8 91 7D 3F  Current buffer size: 23
Generated 4 bytes: 1E 44 4D 17  Current buffer size: 27
Generated 0 bytes:  Current buffer size: 27
Generated 4 bytes: 0E 6C F1 09  Current buffer size: 31
Generated 1 bytes: 21  Current buffer size: 32
Generated 4 bytes: 9B 2F 7F F4  Current buffer size: 36
Generated 0 bytes:  Current buffer size: 36
Generated 5 bytes: D1 0F F0 73 72  Current buffer size: 41
Generated 4 bytes: 7B 5A 2F F8  Current buffer size: 45
Generated 0 bytes:  Current buffer size: 45
Generated 3 bytes: 17 DE AF  Current buffer size: 48
Generated 4 bytes: C6 33 3D 33  Current buffer size: 52
Processing latest 50 bytes: A2 B0 6E FE 37 F7 84 6D 30 77 59 2F CA DD A7 A2 AE E8 91 7D 3F 1E 44 4D 17 0E 6C F1 09 21 9B 2F 7F F4 D1 0F F0 73 72 7B 5A 2F F8 17 DE AF C6 33 3D 33 
Generated 5 bytes: 46 8A 46 C6 25  Current buffer size: 7
Generated 2 bytes: 45 19  Current buffer size: 9
Generated 2 bytes: 8E EA  Current buffer size: 11
Generated 3 bytes: 7E 5D 55  Current buffer size: 14
Generated 5 bytes: D8 B0 4C D0 4A  Current buffer size: 19
Generated 0 bytes:  Current buffer size: 19
Generated 5 bytes: 28 5D 16 EE 90  Current buffer size: 24
Generated 5 bytes: 21 B5 99 AB FC  Current buffer size: 29
Generated 1 bytes: D0  Current buffer size: 30
Generated 4 bytes: A5 E9 46 33  Current buffer size: 34
Generated 3 bytes: 2A B2 30  Current buffer size: 37
Generated 1 bytes: CF  Current buffer size: 38
Generated 2 bytes: 2F 1B  Current buffer size: 40
Generated 3 bytes: 79 C9 C0  Current buffer size: 43
Generated 5 bytes: 26 D6 90 B7 29  Current buffer size: 48
Generated 1 bytes: 6C  Current buffer size: 49
Generated 0 bytes:  Current buffer size: 49
Generated 3 bytes: 68 22 2D  Current buffer size: 52
Generated 0 bytes:  Current buffer size: 52
Generated 5 bytes: 17 21 FA EA 4B  Current buffer size: 57
Processing latest 50 bytes: 45 19 8E EA 7E 5D 55 D8 B0 4C D0 4A 28 5D 16 EE 90 21 B5 99 AB FC D0 A5 E9 46 33 2A B2 30 CF 2F 1B 79 C9 C0 26 D6 90 B7 29 6C 68 22 2D 17 21 FA EA 4B 
```